---
NEP: 372
Title: Runtime Gas Price
Author: Ben Kurrek <ben.kurrek@near.org>, Jakob Meier <jakob@near.org>
DiscussionsTo: https://gov.near.org/t/expose-gas-price-and-contract-access-key-info-within-runtime/24788
Status: Review
Type: Standards Track
Category: Contract
Created: 14-Jul-2022
---

## Summary

There is currently no way to query for the current Gas price at runtime from within smart contracts.

## Motivation

As the network becomes more popular, Gas prices may differ between blocks. By adding the ability to query for the price of Gas, it opens many possibilities for developers. Some use cases could include a contract that knows how much Gas is attached to the call or how much Gas has been used so far using the current `prepaid_gas` and `used_gas` functions but they want to convert that to a $NEAR value using the price of Gas.

## Rationale and alternatives

There doesn't seem to be many alternative solutions other than the one proposed. The implementation is straightforward and doesn't introduce complex behavior.

## Specification

Two new host functions are added to the runtime. One function is for the effective gas price for burning gas during the executing function call. The other is for the pessimistic gas price that has been used to purchase the attached gas to the currently executing receipt.

Both function return a gas price measured in yoctoNEAR per unit of Gas, by writing this value as a `u128` to the guest memory address `gas_price_ptr`.

```rust
/// Effective gas price for execution of the current receipt.
///
/// Returns the actual gas price execution costs right now. This value may
/// change between cross-contract calls due to price adjustment.
/// 
/// Note: At the time of introduction, this is always equal to the gas price
/// of the current block height. But this is not guaranteed to remain that
/// way for future protocol versions.
fn burn_gas_price (gas_price_ptr: u64);


/// Gas priced paid to purchase gas for the current receipt.
///
/// The difference between this and the `burn_gas_price` will be refunded
/// for all the burnt gas, while unused gas will be refunded at the full
/// pessimistic price. This function can be used to calculate how much
/// balance is left in the account after refunds, or how much allowance will
/// be left in an access key.
fn pessimistic_receipt_gas_price (gas_price_ptr: u64);
```

The gas cost for both these calls will be the base host function call `wasm_base` + `wasm_write_memory_base` + 16 * `wasm_write_memory_byte`. This is in-line with similar host functions like `account_balance` that also query a single `u128` value that is readily available at the host.

Both functions must fail with `MemoryAccessViolation` if [`gas_price_ptr`, `gas_price_ptr` + 16) is not completely within guest memory.

When calling the functions in a view method, they must fail with `ProhibitedInView`.

## Reference Implementation

https://github.com/near/nearcore/pull/7204

## User perspective

In the SDK's environment, new functions can be exposed which are queryable at runtime. This function will return the amount of yoctoNEAR it costs to purchase 1 unit of Gas.

```js
/// Returns the amount of yoctoNEAR it costs to purchase 1 unit of Gas.
function burn_gas_price(): Balance

/// Returns the amount of yoctoNEAR/gas that has been paid, pessimistically,
/// when creating the current receipt. This is useful for calculating refunds.
function purchased_gas_price(): Balance
```

The value returned may change between blocks due to an increase in the price. A common scenario to get the amount of yoctoNEAR based on the attached Gas can be seen below.

```rs
pub fn get_yocto_for_gas(gas_to_convert: Gas) -> Balance {
    let cur_price: Balance = env::burn_gas_price();

    // Gas * yocto / Gas = yocto
    return gas_to_convert.0 * cur_price
}
```

## Future possibilities

Due to the simplicity of the standard, not many future possibilities have been thought of.

## Copyright
[copyright]: #copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
